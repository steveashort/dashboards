<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Server Platforms Tracker v31</title>
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="logo.svg">
    <!-- Load Styles -->
    <link rel="stylesheet" href="styles.css">
    <link href="https://unpkg.com/vis-timeline/standalone/umd/vis-timeline-graph2d.min.css" rel="stylesheet" type="text/css" />
    <!-- Load ApexCharts -->
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    <script src="https://unpkg.com/vis-timeline/standalone/umd/vis-timeline-graph2d.min.js"></script>
</head>
<body>
    
    <!-- NEW: LOADING OVERLAY -->
    <div id="loadingOverlay" style="position:fixed; top:0; left:0; width:100%; height:100%; background:var(--bg-color); z-index:99999; display:flex; justify-content:center; align-items:center;">
        <h1 style="color:var(--accent);">Server Platforms Tracker v31</h1>
        <p style="color:var(--text-muted); margin-left: 15px;">Initializing...</p>
    </div>

    <div class="app-layout">
        <aside class="sidebar">
            <div class="sidebar-header">
                <img src="logo.svg" alt="Logo" class="sidebar-logo">
                <h2 id="appTitleSidebar" contenteditable="true" spellcheck="false" onblur="App.saveTitle()" style="font-size:1.2rem; font-weight:300; color:var(--accent); margin:0; outline:none; border-bottom:1px dashed transparent;">Server Platforms</h2>
            </div>
            
            <nav class="sidebar-nav">
                <button id="navTrackers" class="nav-item active" onclick="App.switchView('trackers')">Cards</button>
                <button id="navTeam" class="nav-item" onclick="App.switchView('team')">Team Data</button>
            </nav>
            
            <div class="sidebar-bottom">
                <input type="file" id="fileInput" style="display: none;" accept=".json,.csv" onchange="DataLoader.loadFromFile(this)">
                <button class="btn btn-block" onclick="document.getElementById('fileInput').click()">Load Data</button>
                <button class="btn btn-block" onclick="DataSaver.saveData()">Save JSON</button>
                <button id="btnPublish" class="btn btn-block btn-primary" onclick="App.togglePublishMode()">Publish View</button>
                <button class="btn btn-block" onclick="App.toggleTheme()">Day/Night Theme</button>
                <button class="btn btn-block" onclick="ModalManager.openModal('helpModal')">❓ Help</button>
                <button class="btn btn-block" onclick="SettingsManager.openModal()">⚙ Settings</button>
            </div>
        </aside>
        
        <main class="main-content">
            <div class="content-header">
                <h1 id="pageTitle" style="font-weight:300; color:var(--text-main);">Cards</h1>
                <div style="display:flex; flex-direction:column; align-items:flex-end;">
                    <div id="fyPeriodDisplay" style="font-size:0.75rem; color:var(--text-muted); margin-bottom:4px; font-weight:bold;">...</div>
                    <div class="date-display" id="dateRangeDisplay">...</div>
                </div>
            </div>
            
            <!-- TRACKERS VIEW -->
            <div id="viewTrackers" class="view-section">
                <div class="section-header first" style="justify-content: flex-end; gap: 10px;">
                    <button class="btn" onclick="TrackerManager.openModal(-1)">+ Add Card</button>
                    <button class="btn" onclick="TrackerManager.openSectionModal()">+ Add Section</button>
                </div>
                <div class="tracker-grid" id="trackerGrid"></div>
            </div>
            
            <!-- TEAM DATA VIEW -->
            <div id="viewTeamData" class="view-section" style="display:none;">
                <div class="team-overview-panel">
                    <div class="overview-col" onclick="OverviewManager.handleOverviewClick('success')">
                        <h4 id="overviewTitleCurrent">Top 5 Team Achievements</h4>
                        <div class="edit-hint">(Check max 5 boxes in Last Week)</div>
                        <ul class="overview-list" id="teamSuccessList"><li>No items selected.</li></ul>
                        <button class="btn-reset" onclick="event.stopPropagation(); UserManager.resetSelections('success')">Reset Selection</button>
                    </div>
                    <div class="overview-col" onclick="OverviewManager.handleOverviewClick('activity')">
                        <h4 id="overviewTitleNext">Top 5 Activities Next Week</h4>
                        <div class="edit-hint">(Check max 5 boxes in Next Week)</div>
                        <ul class="overview-list" id="teamActivityList"><li>No items selected.</li></ul>
                        <button class="btn-reset" onclick="event.stopPropagation(); UserManager.resetSelections('activity')">Reset Selection</button>
                    </div>
                    <div class="overview-col interactive" onclick="OverviewManager.handleInfoClick()">
                        <h4>Additional Info</h4>
                        <div class="edit-hint">(Click anywhere to edit)</div>
                        <div id="additionalInfoPreview"></div>
                    </div>
                </div>
                
                <div id="assignmentsSection" style="margin-bottom: 3rem;">
                    <div class="section-header">
                        <h3 style="color:var(--accent); font-weight:300;">Assignments</h3>
                        <button class="btn" onclick="AssignmentManager.openAssignModal()">+ Assign User</button>
                    </div>
                    <div id="assignmentsGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1rem;"></div>
                </div>
                
                <div id="ganttSection" style="margin-bottom: 3rem;">
                    <div class="section-header">
                        <h3 style="color:var(--accent); font-weight:300;">Resource Planner</h3>
                        <button class="btn" onclick="PlannerManager.openModal(-1)">+ Add Planner</button>
                    </div>
                    <div id="ganttContainer" style="background:var(--card-bg); border:1px solid var(--border); border-radius:8px; padding:1rem; overflow-x:auto;"></div>
                    <div id="additionalPlannersContainer" style="margin-top: 2rem; display: flex; flex-direction: column; gap: 2rem;"></div>
                </div>

                <div class="section-header" id="teamSectionHeader">
                    <h3 style="color:var(--accent); font-weight:300;">Team Members</h3>
                    <div style="display:flex; gap:10px;">
                        <button class="btn" onclick="TeamDataManager.openImportModal()">Import User Data</button>
                        <button class="btn btn-primary" onclick="UserManager.openUserModal()">+ Add Person</button>
                    </div>
                </div>
                <div class="team-grid" id="teamGrid"></div>
            </div>
            <!-- ROLES VIEW -->
            <div id="viewRoles" class="view-section" style="display:none;">
                <div class="section-header first">
                    <h3 style="color:var(--accent); font-weight:300;">Roles</h3>
                    <button class="btn" onclick="RoleManager.openModal(-1)">+ Add Role</button>
                </div>
                <div id="rolesGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1rem;"></div>
            </div>

            <!-- EVENTS VIEW -->
            <div id="viewEvents" class="view-section" style="display:none;">
                <div class="section-header first">
                    <h3 style="color:var(--accent); font-weight:300;">Events</h3>
                    <button class="btn" onclick="EventManager.openModal(-1)">+ Add Event</button>
                </div>
                <div id="eventsGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1rem;"></div>
            </div>

            <!-- TASKS VIEW -->
            <div id="viewTasks" class="view-section" style="display:none;">
                <div class="section-header first">
                    <h3 style="color:var(--accent); font-weight:300;">Tasks</h3>
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <select id="taskSortSelect" onchange="TaskManager.render()" style="background:var(--card-bg); border:1px solid var(--border); color:var(--text-muted); padding:5px; border-radius:4px; width:auto; font-size:0.8rem;">
                            <option value="default">Sort by: Default</option>
                            <option value="priority">Sort by: Priority</option>
                            <option value="start">Sort by: Start Date</option>
                            <option value="end">Sort by: End Date</option>
                        </select>
                        <button class="btn" onclick="TaskManager.openModal(-1)">+ Add Task</button>
                    </div>
                </div>
                <div id="tasksGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1rem;"></div>
            </div>
            <!-- SKILLS VIEW -->
            <div id="viewSkills" class="view-section" style="display:none;">
                <div class="section-header first">
                    <h3 style="color:var(--accent); font-weight:300;">Skills</h3>
                    <button class="btn" onclick="SkillManager.openModal(-1)">+ Add Skill</button>
                </div>
                <div id="skillsGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 1rem;"></div>
            </div>
        </main>
    </div>

    <!-- TOOLTIP & MODALS -->
    <div id="globalTooltip"></div>
    
    <div class="modal-overlay" id="alertModal">
        <div class="modal-content modal-mini">
            <div class="modal-body" style="padding-bottom:1rem;">
                <h3 style="margin-bottom:1rem; color:var(--accent);">Notice</h3>
                <p id="alertMessage" style="font-size:1rem; color:#fff;"></p>
            </div>
            <div class="modal-footer" style="justify-content:center; border-top:none;">
                <button class="btn btn-primary" onclick="ModalManager.closeModal('alertModal')">OK</button>
            </div>
        </div>
    </div>
    
    <div class="modal-overlay" id="confirmModal">
        <div class="modal-content modal-mini">
            <div class="modal-body" style="padding-bottom:1rem;">
                <h3 style="margin-bottom:1rem; color:var(--accent);">Confirm</h3>
                <p id="confirmMessage" style="font-size:1rem; color:#fff;"></p>
            </div>
            <div class="modal-footer" style="justify-content:center; border-top:none; gap:1rem;">
                <button class="btn" onclick="ModalManager.closeModal('confirmModal')">Cancel</button>
                <button id="confirmYesBtn" class="btn btn-primary">Yes, Proceed</button>
            </div>
        </div>
    </div>
    
    <div class="modal-overlay" id="zoomModal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3 id="zoomTitle" style="font-size:1.5rem;">View</h3>
                <button class="btn" onclick="ModalManager.closeModal('zoomModal')">&times;</button>
            </div>
            <div class="modal-body" id="zoomBody"></div>
        </div>
    </div>

    <div class="modal-overlay" id="colorPickerModal" style="z-index: 3000;">
        <div class="modal-content modal-mini" style="max-width: 600px;">
            <div class="modal-header">
                <h3 style="color:var(--accent);">Select Color</h3>
                <button class="btn" onclick="ModalManager.closeModal('colorPickerModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div id="colorPickerGrid" class="color-picker-grid"></div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="userModal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h3 id="modalTitle">Add Person</h3>
                <button class="btn" onclick="ModalManager.closeModal('userModal')" style="padding: 0.2rem 0.6rem;">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="editIndex" value="-1">
                
                <div class="form-row" style="gap:1rem; margin-bottom:1rem;">
                    <div class="input-group" style="flex:1;">
                        <label>Full Name</label>
                        <input type="text" id="mName" placeholder="e.g. Alex Chen">
                    </div>
                    <div class="input-group" style="flex:1;">
                        <label>Role</label>
                        <select id="mRole" style="width:100%; padding:8px; background:var(--input-bg); color:#fff; border:1px solid var(--border);" onchange="UserManager.onRoleChange()">
                            <option value="">Select Role...</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-row" style="gap:1rem; margin-bottom:1rem;">
                    <div class="input-group" style="flex:1;">
                        <label>Email</label>
                        <input type="text" id="mEmail" placeholder="alex@example.com">
                    </div>
                    <div class="input-group" style="flex:1;">
                        <label>Engagement Type</label>
                        <select id="mEngagement" style="width:100%; padding:8px; background:var(--input-bg); color:#fff; border:1px solid var(--border);">
                            <option value="">Select Type...</option>
                            <option value="full_time">Full Time</option>
                            <option value="partner">Partner</option>
                            <option value="contractor">Contractor</option>
                            <option value="part_time">Part Time</option>
                        </select>
                    </div>
                </div>

                <div class="form-row" style="gap:1rem; margin-bottom:1rem;">
                    <div class="input-group" style="flex:1;">
                        <label>Start Date</label>
                        <input type="date" id="mStartDate" style="background:var(--input-bg); color:#fff; color-scheme:dark;">
                    </div>
                    <div class="input-group" style="flex:1;">
                        <label>End Date</label>
                        <input type="date" id="mEndDate" style="background:var(--input-bg); color:#fff; color-scheme:dark;">
                    </div>
                </div>

                <div class="input-group" style="margin-bottom: 1rem;">
                    <label>Notes</label>
                    <textarea id="mNotes" maxlength="200" style="height: 60px; font-size: 0.85rem;" placeholder="General notes, key updates..."></textarea>
                </div>

                <div class="input-group" style="margin-bottom: 1rem; border-top: 1px dashed var(--border); padding-top: 1rem;">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <label>Absences</label>
                        <button class="btn btn-sm" onclick="UserManager.addAbsenceRow()">+ Add Absence</button>
                    </div>
                    <div id="mAbsencesContainer" style="max-height: 150px; overflow-y: auto; border: 1px solid var(--border); padding: 10px; border-radius: 4px; background: rgba(0,0,0,0.1); margin-top:5px; display:flex; flex-direction:column; gap:5px;"></div>
                </div>

                <div class="input-group" style="margin-top: 1rem; border-top: 1px solid var(--border); padding-top: 1rem;">
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <label>Assignments (Max 24)</label>
                        <button class="btn btn-sm" onclick="UserManager.addAssignmentRow()">+ Add Assignment</button>
                    </div>
                    <div id="assignmentsContainer" style="max-height: 250px; overflow-y: auto; border: 1px solid var(--border); padding: 10px; border-radius: 4px; background: rgba(0,0,0,0.1); margin-top:5px; display:flex; flex-direction:column; gap:5px;"></div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" style="color: var(--g-red); border-color:var(--g-red);" onclick="UserManager.deleteUser()" id="deleteBtn">Delete</button>
                <button class="btn btn-primary" onclick="UserManager.submitUser()">Save User</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="settingsModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Settings</h3>
                <button class="btn" onclick="ModalManager.closeModal('settingsModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="input-group">
                    <label>Financial Year Start Month</label>
                    <select id="setFyStart" style="width:100%; padding:8px; background:var(--input-bg); color:#fff; border:1px solid var(--border);">
                        <option value="0">January</option>
                        <option value="1">February</option>
                        <option value="2">March</option>
                        <option value="3">April</option>
                        <option value="4">May</option>
                        <option value="5">June</option>
                        <option value="6">July</option>
                        <option value="7">August</option>
                        <option value="8">September</option>
                        <option value="9">October</option>
                        <option value="10">November</option>
                        <option value="11">December</option>
                    </select>
                </div>
                
                <div class="input-group" style="margin-top: 1rem;">
                    <label>Default Roles</label>
                    <div id="setRolesList" style="border:1px solid var(--border); padding:10px; max-height:150px; overflow-y:auto; background:rgba(0,0,0,0.1); border-radius:4px;"></div>
                    <div style="display:flex; gap:5px; margin-top:5px;">
                        <input type="text" id="setNewRole" placeholder="New Role Name">
                        <button class="btn btn-sm" onclick="SettingsManager.addRole()">Add</button>
                    </div>
                </div>

                <div class="input-group" style="margin-top: 1rem;">
                    <label>Default Absence Types</label>
                    <div id="setAbsenceList" style="border:1px solid var(--border); padding:10px; max-height:150px; overflow-y:auto; background:rgba(0,0,0,0.1); border-radius:4px;"></div>
                    <div style="display:flex; gap:5px; margin-top:5px;">
                        <input type="text" id="setNewAbsence" placeholder="New Absence Type">
                        <button class="btn btn-sm" onclick="SettingsManager.addAbsence()">Add</button>
                    </div>
                </div>

                <div class="input-group" style="margin-top: 1rem;">
                    <label>Custom Token Replacements</label>
                    <div id="setTokenList" style="border:1px solid var(--border); padding:10px; max-height:150px; overflow-y:auto; background:rgba(0,0,0,0.1); border-radius:4px;"></div>
                    <div style="display:flex; flex-direction:column; gap:5px; margin-top:5px;">
                        <div style="display:flex; gap:5px;">
                            <input type="text" id="setNewTokenKey" placeholder="Token (e.g. ##Team##)">
                            <input type="text" id="setNewTokenVal" placeholder="Replacement Text">
                        </div>
                        <button class="btn btn-sm btn-block" onclick="SettingsManager.addToken()">Add Custom Token</button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="SettingsManager.save()">Save Settings</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="helpModal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3>Help & Documentation</h3>
                <button class="btn" onclick="ModalManager.closeModal('helpModal')">&times;</button>
            </div>
            <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
                <section style="margin-bottom: 1.5rem;">
                    <h4 style="color: var(--accent); border-bottom: 1px solid var(--border); padding-bottom: 5px;">Card Types</h4>
                    <ul style="padding-left: 1.2rem; line-height: 1.6;">
                        <li><b>Gauge:</b> Visualizes progress against a target as a percentage ring.</li>
                        <li><b>Time Series:</b> Charts data over time (Days, Weeks, Periods) using Lines or Bars.</li>
                        <li><b>Counter:</b> Displays one or more large numeric values with labels.</li>
                        <li><b>RAG Status:</b> Shows a simple Red/Amber/Green status indicator with a message.</li>
                        <li><b>Note:</b> A text-based card supporting Markdown formatting.</li>
                        <li><b>Completion Bar:</b> A horizontal or vertical bar showing progress vs target.</li>
                        <li><b>Donut Chart:</b> Visualizes categorical data as a donut ring with totals.</li>
                        <li><b>Countdown:</b> Tracks upcoming events and shows days remaining.</li>
                        <li><b>Resource Planner:</b> Visualizes assignments, absences, or on-call rotations on a timeline.</li>
                        <li><b>Achievements:</b> Automatically lists team successes and activities.</li>
                        <li><b>Text Parser:</b> Extracts specific sections from large blocks of text using markers.</li>
                        <li><b>Web Page:</b> Embeds an external website or internal URL via iframe.</li>
                    </ul>
                </section>
                <section>
                    <h4 style="color: var(--accent); border-bottom: 1px solid var(--border); padding-bottom: 5px;">Token Replacements</h4>
                    <p style="font-size: 0.9rem; margin-bottom: 10px;">Use these tokens in card titles or notes to automatically insert dynamic dates:</p>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 0.85rem; background: rgba(0,0,0,0.2); padding: 10px; border-radius: 4px;">
                        <div><b>##CWL##</b>: Current Week Range</div>
                        <div><b>##CWP##</b>: Current Period</div>
                        <div><b>##LWL##</b>: Last Week Range</div>
                        <div><b>##LWP##</b>: Last Period</div>
                        <div><b>##NWL##</b>: Next Week Range</div>
                        <div><b>##NWP##</b>: Next Period</div>
                        <div><b>##CWW##</b>: Current Week ID</div>
                        <div><b>##CWQ##</b>: Current Quarter</div>
                    </div>
                    <p style="font-size: 0.8rem; color: var(--text-muted); margin-top: 10px;">Replace 'CW' with 'LW' (Last Week) or 'NW' (Next Week) for other ranges. Custom tokens can be defined in Settings.</p>
                </section>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="trackerModal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h3 id="trackerModalTitle">Add Card</h3>
                <button class="btn" onclick="ModalManager.closeModal('trackerModal')">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="editTrackerIndex" value="-1">
                <div class="type-selector" id="trackerTypeSelector">
                    <button id="typeGaugeBtn" class="type-option active" onclick="TrackerManager.setType('gauge')">Gauge</button>
                    <button id="typeLineBtn" class="type-option" onclick="TrackerManager.setType('line')">Time Series</button>
                    <button id="typeCounterBtn" class="type-option" onclick="TrackerManager.setType('counter')">Counter</button>
                    <button id="typeRagBtn" class="type-option" onclick="TrackerManager.setType('rag')">RAG Status</button>
                    <button id="typeNoteBtn" class="type-option" onclick="TrackerManager.setType('note')">Note</button>
                    <button id="typeCompletionBarBtn" class="type-option" onclick="TrackerManager.setType('completionBar')">Completion Bar</button>
                    <button id="typeDonutBtn" class="type-option" onclick="TrackerManager.setType('donut')">Donut Chart</button>
                    <button id="typeCountdownBtn" class="type-option" onclick="TrackerManager.setType('countdown')">Countdown</button>
                    <button id="typePlannerBtn" class="type-option" onclick="TrackerManager.setType('planner')">Resource Planner</button>
                    <button id="typeAchievementsBtn" class="type-option" onclick="TrackerManager.setType('achievements')">Achievements</button>
                    <button id="typeTextParserBtn" class="type-option" onclick="TrackerManager.setType('textParser')">Text Parser</button>
                    <button id="typeWebpageBtn" class="type-option" onclick="TrackerManager.setType('webpage')">Web Page</button>
                </div>
                <div class="form-row" style="margin-bottom: 1rem; gap: 1rem;">
                    <div class="input-group" style="flex: 2;">
                        <label>Card Title</label>
                        <input type="text" id="tkDesc">
                    </div>
                    <div class="input-group" style="flex: 1;" id="tabSelectorContainer">
                        <label>Tracker Tab</label>
                        <select id="tkTabId" style="background:var(--input-bg); color:#fff; height: 38px; border: 1px solid #444; border-radius: 4px; padding: 0 8px; width: 100%;"></select>
                    </div>
                    <div class="input-group" style="flex: 0 0 180px;" id="sizeContainer">
                        <label>Size</label>
                        <div id="tkSize" style="display:flex; gap:10px; margin-top:5px; flex-wrap:wrap;">
                            <label id="lblSize1x1" style="display:inline-flex; align-items:center; gap:3px; font-size:0.8rem;"><input type="radio" name="tkSize" value="1x1"> 1x1</label>
                            <label id="lblSize1x2" style="display:inline-flex; align-items:center; gap:3px; font-size:0.8rem;"><input type="radio" name="tkSize" value="1x2"> 1x2</label>
                            <label id="lblSize1x3" style="display:inline-flex; align-items:center; gap:3px; font-size:0.8rem;"><input type="radio" name="tkSize" value="1x3"> 1x3</label>
                            <label id="lblSize1x4" style="display:inline-flex; align-items:center; gap:3px; font-size:0.8rem;"><input type="radio" name="tkSize" value="1x4"> 1x4</label>
                            <label id="lblSize2x1" style="display:inline-flex; align-items:center; gap:3px; font-size:0.8rem;"><input type="radio" name="tkSize" value="2x1"> 2x1</label>
                            <label id="lblSize2x2" style="display:inline-flex; align-items:center; gap:3px; font-size:0.8rem;"><input type="radio" name="tkSize" value="2x2"> 2x2</label>
                            <label id="lblSize2x3" style="display:inline-flex; align-items:center; gap:3px; font-size:0.8rem;"><input type="radio" name="tkSize" value="2x3"> 2x3</label>
                            <label id="lblSize2x4" style="display:inline-flex; align-items:center; gap:3px; font-size:0.8rem;"><input type="radio" name="tkSize" value="2x4"> 2x4</label>
                            <label id="lblSize3x1" style="display:inline-flex; align-items:center; gap:3px; font-size:0.8rem;"><input type="radio" name="tkSize" value="3x1"> 3x1</label>
                            <label id="lblSize3x2" style="display:inline-flex; align-items:center; gap:3px; font-size:0.8rem;"><input type="radio" name="tkSize" value="3x2"> 3x2</label>
                            <label id="lblSize3x3" style="display:inline-flex; align-items:center; gap:3px; font-size:0.8rem;"><input type="radio" name="tkSize" value="3x3"> 3x3</label>
                            <label id="lblSize3x4" style="display:inline-flex; align-items:center; gap:3px; font-size:0.8rem;"><input type="radio" name="tkSize" value="3x4"> 3x4</label>
                            <label id="lblSize4x1" style="display:inline-flex; align-items:center; gap:3px; font-size:0.8rem;"><input type="radio" name="tkSize" value="4x1"> 4x1</label>
                            <label id="lblSize4x2" style="display:inline-flex; align-items:center; gap:3px; font-size:0.8rem;"><input type="radio" name="tkSize" value="4x2"> 4x2</label>
                            <label id="lblSize4x3" style="display:inline-flex; align-items:center; gap:3px; font-size:0.8rem;"><input type="radio" name="tkSize" value="4x3"> 4x3</label>
                            <label id="lblSize4x4" style="display:inline-flex; align-items:center; gap:3px; font-size:0.8rem;"><input type="radio" name="tkSize" value="4x4"> 4x4</label>
                        </div>
                    </div>
                </div>

                                <div id="gaugeInputs">

                                    <div class="input-group"><label>Metric Unit</label><input type="text" id="tkMetric" maxlength="15"></div>

                                    <div class="form-row" style="margin-bottom:0; gap:1rem;">

                                        <div class="input-group"><label>Target</label><input type="number" id="tkTotal"></div>

                                        <div class="input-group"><label>Progress</label><input type="number" id="tkComp"></div>

                                    </div>

                                    <div class="form-row" style="margin-top: 1rem; margin-bottom: 0; gap: 1rem;">

                                        <div class="input-group">

                                            <label>Target Colour</label>

                                            <input type="text" readonly class="color-input" id="tkPieColor" value="#696969">

                                        </div>

                                        <div class="input-group">

                                            <label>Progress Colour</label>

                                            <input type="text" readonly class="color-input" id="tkPieColor2" value="#228B22">

                                        </div>

                                    </div>

                                    <div class="input-group" style="margin-top: 1rem;">

                                        <label>Notes for Published View (Max 200 chars)</label>

                                        <textarea id="tkNotes" maxlength="200" style="height: 60px; font-size: 0.85rem;" placeholder="Enter details to display on hover..."></textarea>

                                    </div>

                                </div>

                                <div id="lineInputs" style="display:none;">

                                    <div class="form-row" style="margin-bottom: 1rem; gap: 2rem;">

                                        <div class="input-group">

                                            <label>Metric Unit</label>

                                            <input type="text" id="tkYLabel" maxlength="15">

                                        </div>

                                        <div class="input-group">

                                            <label>Chart Style</label>

                                            <div style="display:flex; gap:15px; margin-top:5px;">

                                                <label style="display:inline-flex; align-items:center; gap:5px;"><input type="radio" name="tkDisplayStyle" value="line" checked> Line Chart</label>

                                                <label style="display:inline-flex; align-items:center; gap:5px;"><input type="radio" name="tkDisplayStyle" value="bar"> Bar Chart</label>

                                            </div>

                                        </div>

                                    </div>

                                    <div class="form-row" style="margin-bottom: 1rem; align-items: flex-end; display: flex; gap: 2rem;">

                                        <div class="input-group">

                                            <label>End Date</label>

                                            <input type="date" id="tkStartDate" onchange="TrackerManager.handleEndDateChange(this)" style="background:var(--input-bg); color:#fff; color-scheme:dark;">

                                        </div>

                                        <div class="input-group">

                                            <label>Time Unit</label>

                                            <div style="display: flex; gap: 15px; margin-top: 5px;" id="tkTimeUnitContainer">

                                                <label style="display:inline-flex; align-items:center; gap:5px;"><input type="radio" name="tkTimeUnit" value="day" checked onchange="TrackerManager.handleTimeUnitChange(this)"> Days</label>

                                                <label style="display:inline-flex; align-items:center; gap:5px;"><input type="radio" name="tkTimeUnit" value="month" onchange="TrackerManager.handleTimeUnitChange(this)"> Months</label>

                                                <label style="display:inline-flex; align-items:center; gap:5px;"><input type="radio" name="tkTimeUnit" value="year" onchange="TrackerManager.handleTimeUnitChange(this)"> Years</label>

                                            </div>

                                        </div>

                                        <div class="input-group">

                                            <label id="tkHistoricLabel">Historic Days</label>

                                            <select id="tkTimeCount" onchange="TrackerManager.handleCountChange(this)" style="width: 80px; min-width: 60px;"></select>

                                        </div>

                                    </div>

                                    <div class="input-group">

                                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;">

                                            <label>Manual Data Entry</label>

                                        </div>

                                        <div id="lineTableContainer" style="max-height: 450px; overflow: auto; border: 1px solid #333; border-radius: 4px;"></div>

                                        <div style="margin-top: 10px; display:flex; justify-content:flex-end;">

                                            <button class="btn btn-sm" style="color:var(--g-red); border-color:var(--g-red); display: none;" onclick="TrackerManager.deleteSelectedSeries()">Delete Series</button>

                                        </div>

                                    </div>

                                    <div class="input-group" style="margin-bottom: 1rem; background: rgba(255,255,255,0.05); padding: 10px; border-radius: 4px; margin-top: 1rem;">

                                        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;">

                                            <label style="margin:0;">Import / Export Data</label>

                                            <button class="btn btn-sm" onclick="TrackerManager.exportTimeSeriesCSV()">Export Table to CSV</button>

                                        </div>

                                        <textarea id="csvInput" placeholder="Paste CSV data here...&#10;Date, Series1, Series2...&#10;2023-01-01, 10, 20" style="height: 60px; font-family: monospace; font-size: 0.8rem;"></textarea>

                                        <button class="btn btn-sm" style="margin-top: 5px;" onclick="TrackerManager.parseCSV('line')">Parse CSV & Auto-fill</button>

                                    </div>

                                    <div class="input-group" style="margin-top: 1rem;">
                                        <label>Notes for Published View (Max 200 chars)</label>
                                        <textarea id="tkLineNotes" maxlength="200" style="height: 60px; font-size: 0.85rem;" placeholder="Enter details to display on hover..."></textarea>
                                    </div>

                                </div>

                                                                                                <div id="completionbarInputs" style="display:none;">
                                                                                                    <div class="input-group">
                                                                                                        <label>Metric Unit</label>
                                                                                                        <input type="text" id="tkCompBarMetric" maxlength="15">
                                                                                                    </div>
                                                                                                    <div class="input-group">
                                                                                                        <label>Orientation</label>
                                                                                                        <div style="display:flex; gap:15px; margin-top:5px;">
                                                                                                            <label style="display:inline-flex; align-items:center; gap:5px;"><input type="radio" name="tkCompBarOrient" value="horizontal" checked> Horizontal</label>
                                                                                                            <label style="display:inline-flex; align-items:center; gap:5px;"><input type="radio" name="tkCompBarOrient" value="vertical"> Vertical</label>
                                                                                                        </div>
                                                                                                    </div>
                                                                                                    <div class="form-row" style="margin-bottom:0; gap:1rem;">
                                                                                                        <div class="input-group">
                                                                                                            <label>Target</label>
                                                                                                            <input type="number" id="tkCompBarTotal">
                                                                                                        </div>
                                                                                                        <div class="input-group">
                                                                                                            <label>Progress</label>
                                                                                                            <input type="number" id="tkCompBarActive">
                                                                                                        </div>
                                                                                                    </div>
                                                                                                    <div class="form-row" style="margin-top: 1rem; margin-bottom: 0; gap: 1rem;">
                                                                                                        <div class="input-group">
                                                                                                            <label>Target Colour</label>
                                                                                                            <input type="text" readonly class="color-input" id="tkCompBarColorBg" value="#696969">
                                                                                                        </div>
                                                                                                        <div class="input-group">
                                                                                                            <label>Progress Colour</label>
                                                                                                            <input type="text" readonly class="color-input" id="tkCompBarColorVal" value="#228B22">
                                                                                                        </div>
                                                                                                    </div>
                                                                                                    <div class="input-group" style="margin-top: 1rem;">
                                                                                                        <label>Notes for Published View (Max 200 chars)</label>
                                                                                                        <textarea id="tkCompBarNotes" maxlength="200" style="height: 60px; font-size: 0.85rem;" placeholder="Enter details to display on hover..."></textarea>
                                                                                                    </div>
                                                                                                </div>

                                    <div id="plannerInputs" style="display:none;">
                                        <div class="input-group">
                                            <label>Range</label>
                                            <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:5px;">
                                                <label style="display:inline-flex; align-items:center; gap:5px;"><input type="radio" name="tkPlannerRange" value="3" checked> 3 Months</label>
                                                <label style="display:inline-flex; align-items:center; gap:5px;"><input type="radio" name="tkPlannerRange" value="6"> 6 Months</label>
                                                <label style="display:inline-flex; align-items:center; gap:5px;"><input type="radio" name="tkPlannerRange" value="12"> 12 Months</label>
                                                <label style="display:inline-flex; align-items:center; gap:5px;"><input type="radio" name="tkPlannerRange" value="18"> 18 Months</label>
                                                <label style="display:inline-flex; align-items:center; gap:5px;"><input type="radio" name="tkPlannerRange" value="24"> 24 Months</label>
                                                <label style="display:inline-flex; align-items:center; gap:5px;"><input type="radio" name="tkPlannerRange" value="36"> 36 Months</label>
                                            </div>
                                        </div>
                                        <div class="input-group">
                                            <label>Tracking Type</label>
                                            <div style="display:flex; gap:15px; margin-top:5px;">
                                                <label style="display:inline-flex; align-items:center; gap:5px;"><input type="radio" name="tkPlannerType" value="Role" checked onchange="TrackerManager.renderPlannerMultiSelect()"> Role</label>
                                                <label style="display:inline-flex; align-items:center; gap:5px;"><input type="radio" name="tkPlannerType" value="Task" onchange="TrackerManager.renderPlannerMultiSelect()"> Task</label>
                                                <label style="display:inline-flex; align-items:center; gap:5px;"><input type="radio" name="tkPlannerType" value="Event" onchange="TrackerManager.renderPlannerMultiSelect()"> Event</label>
                                                <label style="display:inline-flex; align-items:center; gap:5px;"><input type="radio" name="tkPlannerType" value="Absence" onchange="TrackerManager.renderPlannerMultiSelect()"> Absence</label>
                                                <label style="display:inline-flex; align-items:center; gap:5px;"><input type="radio" name="tkPlannerType" value="On Call" onchange="TrackerManager.renderPlannerMultiSelect()"> On Call</label>
                                            </div>
                                        </div>
                                        <div class="input-group" id="plannerMultiSelectContainer" style="margin-top: 1rem; max-height: 150px; overflow-y: auto; border: 1px solid var(--border); padding: 10px; border-radius: 4px; background: rgba(0,0,0,0.1);">
                                            <!-- Checkboxes will be injected here -->
                                        </div>
                                        <div class="input-group" style="margin-top: 1rem;">
                                            <label>Notes for Published View (Max 200 chars)</label>
                                            <textarea id="tkPlannerNotes" maxlength="200" style="height: 60px; font-size: 0.85rem;" placeholder="Enter details to display on hover..."></textarea>
                                        </div>
                                    </div>

                                    <div id="achievementsInputs" style="display:none;">
                                        <div class="form-row" style="margin-bottom: 1rem; gap: 1rem;">
                                            <div class="input-group">
                                                <label>Display Options</label>
                                                <div style="margin-top: 5px;">
                                                    <label style="display:inline-flex; align-items:center; gap:8px; cursor:pointer;">
                                                        <input type="checkbox" id="tkAchShowName" checked style="accent-color:var(--accent);"> Show User Name
                                                    </label>
                                                </div>
                                            </div>
                                            <div class="input-group">
                                                <label>Max Items (Total)</label>
                                                <input type="number" id="tkAchLimit" value="5" min="1" max="50">
                                            </div>
                                        </div>
                                        <div class="input-group">
                                            <label>Data Sources & Filters</label>
                                            <div style="display:flex; flex-direction:column; gap:15px; margin-top:5px;">
                                                
                                                <!-- Last Week -->
                                                <div class="ach-source-group">
                                                    <label style="display:inline-flex; align-items:center; gap:8px; font-weight:bold; color:var(--accent);">
                                                        <input type="checkbox" id="tkAchLast" style="accent-color:var(--accent);" onchange="TrackerManager.toggleAchList('last')"> 
                                                        Last Week (Successes)
                                                    </label>
                                                    <div id="achListLast" class="ach-list-container" style="margin-top:5px; max-height:100px; overflow-y:auto; border:1px solid var(--border); padding:5px; border-radius:4px; background:rgba(0,0,0,0.1); opacity:0.5; pointer-events:none;">
                                                        <!-- Items injected here -->
                                                    </div>
                                                </div>

                                                <!-- Current Week -->
                                                <div class="ach-source-group">
                                                    <label style="display:inline-flex; align-items:center; gap:8px; font-weight:bold; color:var(--accent);">
                                                        <input type="checkbox" id="tkAchCurrent" style="accent-color:var(--accent);" onchange="TrackerManager.toggleAchList('current')"> 
                                                        Current Week (Priorities)
                                                    </label>
                                                    <div id="achListCurrent" class="ach-list-container" style="margin-top:5px; max-height:100px; overflow-y:auto; border:1px solid var(--border); padding:5px; border-radius:4px; background:rgba(0,0,0,0.1); opacity:0.5; pointer-events:none;">
                                                        <!-- Items injected here -->
                                                    </div>
                                                </div>

                                                <!-- Next Week -->
                                                <div class="ach-source-group">
                                                    <label style="display:inline-flex; align-items:center; gap:8px; font-weight:bold; color:var(--accent);">
                                                        <input type="checkbox" id="tkAchNext" style="accent-color:var(--accent);" onchange="TrackerManager.toggleAchList('next')"> 
                                                        Next Week (Planned Work)
                                                    </label>
                                                    <div id="achListNext" class="ach-list-container" style="margin-top:5px; max-height:100px; overflow-y:auto; border:1px solid var(--border); padding:5px; border-radius:4px; background:rgba(0,0,0,0.1); opacity:0.5; pointer-events:none;">
                                                        <!-- Items injected here -->
                                                    </div>
                                                </div>

                                            </div>
                                        </div>
                                        <div class="input-group" style="margin-top: 1rem;">
                                            <label>Notes for Published View (Max 200 chars)</label>
                                            <textarea id="tkAchNotes" maxlength="200" style="height: 60px; font-size: 0.85rem;" placeholder="Enter details to display on hover..."></textarea>
                                        </div>
                                    </div>

                                    <div id="textparserInputs" style="display:none;">
                                        <div class="input-group">
                                            <label>Raw Text</label>
                                            <textarea id="tkParserText" style="height: 150px; font-size: 0.85rem; font-family: monospace;" placeholder="Paste text here..."></textarea>
                                        </div>
                                        <div class="form-row" style="margin-top:1rem; gap:1rem;">
                                            <div class="input-group">
                                                <label>Start Marker</label>
                                                <input type="text" id="tkParserStart" placeholder="e.g. START_HERE">
                                            </div>
                                            <div class="input-group">
                                                <label>End Marker</label>
                                                <input type="text" id="tkParserEnd" placeholder="e.g. END_HERE">
                                            </div>
                                        </div>
                                        <div class="input-group" style="margin-top:1rem;">
                                            <label>Header Markers (one per line)</label>
                                            <textarea id="tkParserHeaders" style="height: 80px; font-size: 0.85rem;" placeholder="Enter one marker per line..."></textarea>
                                        </div>
                                    </div>

                                    <div id="sectionInputs" style="display:none;">
                                        <div class="input-group">
                                            <p style="font-size: 0.85rem; color: var(--text-muted); font-style: italic;">
                                                A section header spans the full width of the grid to logically group cards. Use the "Card Title" field above for the header text.
                                            </p>
                                        </div>
                                    </div>

                                    <div id="webpageInputs" style="display:none;">
                                        <div class="input-group">
                                            <label>Page URL</label>
                                            <input type="text" id="tkWebpageUrl" placeholder="https://example.com">
                                            <p style="font-size: 0.75rem; color: var(--text-muted); margin-top: 5px; font-style: italic;">
                                                Note: Some websites block being embedded in other pages (X-Frame-Options).
                                            </p>
                                        </div>
                                    </div>
                
                <div id="counterInputs" style="display:none;">
                    <div class="input-group">
                        <label>Counters (Max 6)</label>
                        <div id="counterDataContainer" style="max-height: 300px; overflow-y: auto; border: 1px solid #333; padding: 10px; border-radius: 4px; background: rgba(0,0,0,0.1);">
                            <!-- Rows will be added here -->
                        </div>
                        <button class="btn btn-sm" style="margin-top: 10px;" onclick="TrackerManager.addCounterRow()">+ Add Counter</button>
                    </div>

                    <div class="input-group" style="margin-top: 1rem;">
                        <label>Notes for Published View (Max 200 chars)</label>
                        <textarea id="tkCounterNotes" maxlength="200" style="height: 60px; font-size: 0.85rem;" placeholder="Enter details to display on hover..."></textarea>
                    </div>
                </div>

                                <div id="ragInputs" style="display:none;">

                                    <div class="input-group">

                                        <label>Status</label>

                                                                <div class="rag-selector">

                                                                    <div class="rag-pill" data-val="green" onclick="TrackerManager.selectRag('green')">

                                                                        <svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">

                                                                          <path d="M22 11.08V12C21.9988 14.1564 21.3005 16.2547 20.0093 17.9818C18.7182 19.709 16.9033 20.9725 14.8354 21.5839C12.7674 22.1953 10.5573 22.1219 8.53447 21.3746C6.51168 20.6273 4.78465 19.2461 3.61096 17.4371C2.43727 15.628 1.87979 13.4881 2.02168 11.3363C2.16356 9.18455 2.99721 7.13631 4.39828 5.49706C5.79935 3.85781 7.69279 2.71537 9.79619 2.24013C11.8996 1.7649 14.1003 1.98232 16.07 2.85999" stroke="#16A34A" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>

                                                                          <path d="M22 4L12 14.01L9 11.01" stroke="#16A34A" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>

                                                                        </svg>

                                                                    </div>

                                                                    <div class="rag-pill" data-val="amber" onclick="TrackerManager.selectRag('amber')">

                                                                        <svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">

                                                                          <path d="M10.29 3.86L1.82 18C1.64556 18.3024 1.55293 18.6453 1.55196 18.9945C1.55098 19.3437 1.64171 19.6871 1.81506 19.991C1.98841 20.2949 2.23846 20.5487 2.54076 20.7275C2.84306 20.9063 3.18721 21.0041 3.54 21H20.46C20.8128 21.0041 21.1569 20.9063 21.4592 20.7275C21.7615 20.5487 22.0116 20.2949 22.1849 19.991C22.3583 19.6871 22.449 19.3437 22.448 18.9945C22.4471 18.6453 22.3544 18.3024 22.18 18L13.71 3.86C13.5317 3.56613 13.2807 3.32314 12.9812 3.15449C12.6817 2.98585 12.3437 2.89722 12 2.89722C11.6563 2.89722 11.3183 2.98585 11.0188 3.15449C10.7193 3.32314 10.4683 3.56613 10.29 3.86V3.86Z" fill="#D97706" stroke="#D97706" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>

                                                                          <path d="M12 9V13" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>

                                                                          <path d="M12 17H12.01" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>

                                                                        </svg>

                                                                    </div>

                                                                    <div class="rag-pill" data-val="red" onclick="TrackerManager.selectRag('red')">

                                                                        <svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">

                                                                          <path d="M7.86 2H16.14L22 7.86V16.14L16.14 22H7.86L2 16.14V7.86L7.86 2Z" fill="#DC2626" stroke="#DC2626" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>

                                                                          <path d="M15 9L9 15" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>

                                                                          <path d="M9 9L15 15" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>

                                                                        </svg>

                                                                    </div>

                                                                    <div class="rag-pill" data-val="grey" onclick="TrackerManager.selectRag('grey')">

                                                                        <svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">

                                                                          <circle cx="12" cy="12" r="10" fill="#9CA3AF" />

                                                                          <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3M12 17h.01" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>

                                                                        </svg>

                                                                    </div>

                                                                </div>

                                        <input type="hidden" id="tkRagStatus">

                                    </div>

                                                        <div class="input-group">

                                                            <label>Status Message</label>

                                                            <input type="text" id="tkRagMsg" maxlength="15" placeholder="e.g. All Systems Operational">

                                                        </div>

                                                        <div class="input-group" style="margin-top: 1rem;">

                                                            <label>Notes for Published View (Max 200 chars)</label>

                                                            <textarea id="tkRagNotes" maxlength="200" style="height: 60px; font-size: 0.85rem;" placeholder="Enter details to display on hover..."></textarea>

                                                        </div>

                                                    </div>

                                                                                                <div id="noteInputs" style="display:none;">

                                                                                                    <div class="input-group">

                                                                                                        <label>Content (Markdown supported)</label>

                                                                                                        <textarea id="tkNoteContent" style="height: 200px; font-family: monospace;" placeholder="# Heading&#10;- Bullet&#10;**Bold**&#10;[Link](google.com)"></textarea>

                                                                                                    </div>

                                                                                                    <div class="input-group">
                                                                                                        <label>Text Alignment</label>
                                                                                                        <div style="display:flex; gap:15px; margin-top:5px;">
                                                                                                            <label style="display:inline-flex; align-items:center; gap:5px;"><input type="radio" name="tkNoteAlign" value="left" checked> Left</label>
                                                                                                            <label style="display:inline-flex; align-items:center; gap:5px;"><input type="radio" name="tkNoteAlign" value="center"> Center</label>
                                                                                                            <label style="display:inline-flex; align-items:center; gap:5px;"><input type="radio" name="tkNoteAlign" value="right"> Right</label>
                                                                                                        </div>
                                                                                                    </div>

                                                                                                </div>

                                                                

                                                                                                <div id="donutInputs" style="display:none;">

                                                                                                    <div class="input-group">

                                                                                                        <label>Segments (Max 10)</label>

                                                                                                        <div id="donutDataContainer" style="max-height: 300px; overflow-y: auto; border: 1px solid #333; padding: 10px; border-radius: 4px; background: rgba(0,0,0,0.1);">

                                                                                                            <!-- Rows will be added here -->

                                                                                                        </div>

                                                                                                        <button class="btn btn-sm" style="margin-top: 10px;" onclick="TrackerManager.addDonutRow()">+ Add Segment</button>

                                                                                                    </div>

                                                                                                    <div class="input-group" style="margin-top: 1rem;">

                                                                                                        <label>Notes for Published View (Max 200 chars)</label>

                                                                                                        <textarea id="tkDonutNotes" maxlength="200" style="height: 60px; font-size: 0.85rem;" placeholder="Enter details to display on hover..."></textarea>

                                                                                                    </div>

                                                                                                </div>

                                                                                                <div id="countdownInputs" style="display:none;">
                                                                                                    <div class="input-group">
                                                                                                        <label>Display Style</label>
                                                                                                        <div style="display:flex; gap:15px; margin-top:5px;">
                                                                                                            <label style="display:inline-flex; align-items:center; gap:5px;"><input type="radio" name="tkCountdownStyle" value="list" checked> List</label>
                                                                                                            <label style="display:inline-flex; align-items:center; gap:5px;"><input type="radio" name="tkCountdownStyle" value="bar"> Bar Chart</label>
                                                                                                        </div>
                                                                                                    </div>
                                                                                                    <div class="input-group">
                                                                                                        <label>Events (Max 128)</label>
                                                                                                        <div id="countdownDataContainer" style="max-height: 300px; overflow-y: auto; border: 1px solid #333; padding: 10px; border-radius: 4px; background: rgba(0,0,0,0.1);"></div>
                                                                                                        <button class="btn btn-sm" style="margin-top: 10px;" onclick="TrackerManager.addCountdownRow()">+ Add Event</button>
                                                                                                    </div>
                                                                                                    <div class="input-group" style="margin-top: 1rem;">
                                                                                                        <label>Notes for Published View (Max 200 chars)</label>
                                                                                                        <textarea id="tkCountdownNotes" maxlength="200" style="height: 60px; font-size: 0.85rem;" placeholder="Enter details to display on hover..."></textarea>
                                                                                                    </div>
                                                                                                </div>

                                                                            </div>

                                                                            <div class="modal-footer">

                                                                                <button class="btn btn-primary" onclick="TrackerManager.submitTracker()">Save Card</button>

                                                                            </div>

                                                                        </div>

                                                                    </div>

    <div class="modal-overlay" id="plannerModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="plannerModalTitle">Add Planner</h3>
                <button class="btn" onclick="ModalManager.closeModal('plannerModal')">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="editPlannerIndex" value="-1">
                <div class="input-group">
                    <label>Name</label>
                    <input type="text" id="plName" placeholder="e.g. Q3 Roadmap">
                </div>
                <div class="input-group">
                    <label>Description</label>
                    <textarea id="plDesc" style="height: 60px; font-size: 0.85rem;" placeholder="Brief description..."></textarea>
                </div>
                <div class="input-group">
                    <label>Range</label>
                    <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:5px;">
                        <label style="display:inline-flex; align-items:center; gap:5px;"><input type="radio" name="plRange" value="3" checked> 3 Months</label>
                        <label style="display:inline-flex; align-items:center; gap:5px;"><input type="radio" name="plRange" value="6"> 6 Months</label>
                        <label style="display:inline-flex; align-items:center; gap:5px;"><input type="radio" name="plRange" value="12"> 12 Months</label>
                    </div>
                </div>
                <div class="input-group">
                    <label>Type</label>
                    <div style="display:flex; gap:15px; margin-top:5px;">
                        <label style="display:inline-flex; align-items:center; gap:5px;"><input type="radio" name="plType" value="Role" checked> Role</label>
                        <label style="display:inline-flex; align-items:center; gap:5px;"><input type="radio" name="plType" value="Task"> Task</label>
                        <label style="display:inline-flex; align-items:center; gap:5px;"><input type="radio" name="plType" value="Event"> Event</label>
                        <label style="display:inline-flex; align-items:center; gap:5px;"><input type="radio" name="plType" value="Absence"> Absence</label>
                        <label style="display:inline-flex; align-items:center; gap:5px;"><input type="radio" name="plType" value="On Call"> On Call</label>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" style="color: var(--g-red); border-color:var(--g-red); display:none;" onclick="PlannerManager.deletePlanner()" id="btnDelPlanner">Delete</button>
                <button class="btn btn-primary" onclick="PlannerManager.submitPlanner()">Save Planner</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="assignmentModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="assignmentModalTitle">Add Assignment</h3>
                <button class="btn" onclick="ModalManager.closeModal('assignmentModal')">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="editAssignmentIndex" value="-1">
                <div class="input-group">
                    <label>Name</label>
                    <input type="text" id="asName" placeholder="e.g. Firewatch">
                </div>
                <div class="input-group">
                    <label>Description</label>
                    <textarea id="asDesc" style="height: 60px; font-size: 0.85rem;" placeholder="Brief description..."></textarea>
                </div>
                <div class="form-row" style="gap: 1rem; margin-bottom: 1rem;">
                    <div class="input-group">
                        <label>Class</label>
                        <select id="asClass" style="width: 100%; padding: 8px; background: var(--input-bg); color: #fff; border: 1px solid var(--border); border-radius: 4px;">
                            <option value="Role">Role</option>
                            <option value="Task">Task</option>
                            <option value="Project">Project</option>
                        </select>
                    </div>
                    <div class="input-group">
                        <label>Priority</label>
                        <div style="display: flex; gap: 10px; margin-top: 8px;">
                            <label style="font-size:0.85rem;"><input type="radio" name="asPriority" value="High"> High</label>
                            <label style="font-size:0.85rem;"><input type="radio" name="asPriority" value="Med" checked> Med</label>
                            <label style="font-size:0.85rem;"><input type="radio" name="asPriority" value="Low"> Low</label>
                        </div>
                    </div>
                </div>
                <div class="form-row" style="gap: 1rem; margin-bottom: 1rem;">
                    <div class="input-group">
                        <label>Start Date</label>
                        <input type="date" id="asStart" style="background:var(--input-bg); color:#fff; color-scheme:dark;">
                    </div>
                    <div class="input-group">
                        <label>End Date</label>
                        <input type="date" id="asEnd" style="background:var(--input-bg); color:#fff; color-scheme:dark;">
                    </div>
                </div>
                <div class="input-group">
                    <label>Colour tag</label>
                    <input type="text" readonly class="color-input" id="asColor" value="#03dac6" style="cursor:pointer;">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" style="color: var(--g-red); border-color:var(--g-red);" onclick="AssignmentManager.deleteAssignment()" id="btnDelAssignment">Delete</button>
                <button class="btn btn-primary" onclick="AssignmentManager.submitAssignment()">Save</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="roleModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="roleModalTitle">Add Role</h3>
                <button class="btn" onclick="ModalManager.closeModal('roleModal')">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="editRoleIndex" value="-1">
                <div class="input-group" id="rlIdContainer" style="display:none;">
                    <label>Role ID</label>
                    <input type="text" id="rlId" readonly style="background: rgba(255,255,255,0.05); color: var(--text-muted); cursor: not-allowed;">
                </div>
                <div class="input-group">
                    <label>Role Name</label>
                    <input type="text" id="rlName" placeholder="e.g. System Administrator">
                </div>
                <div class="input-group">
                    <label>Description</label>
                    <textarea id="rlDesc" style="height: 60px; font-size: 0.85rem;" placeholder="Brief description..."></textarea>
                </div>
                <div class="input-group" style="margin-top: 1rem;">
                    <label>Required Skills</label>
                    <div id="rlSkillsContainer" style="max-height: 150px; overflow-y: auto; border: 1px solid var(--border); padding: 10px; border-radius: 4px; background: rgba(0,0,0,0.1); display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 5px;">
                        <!-- Checkboxes will be injected here -->
                    </div>
                </div>
                <div class="form-row" style="gap: 1rem; margin-bottom: 1rem;">
                    <div class="input-group">
                        <label>Priority</label>
                        <div style="display: flex; gap: 10px; margin-top: 8px;">
                            <label style="font-size:0.85rem;"><input type="radio" name="rlPriority" value="High"> High</label>
                            <label style="font-size:0.85rem;"><input type="radio" name="rlPriority" value="Med" checked> Med</label>
                            <label style="font-size:0.85rem;"><input type="radio" name="rlPriority" value="Low"> Low</label>
                        </div>
                    </div>
                    <div class="input-group">
                        <label>Colour tag</label>
                        <input type="text" readonly class="color-input" id="rlColor" value="#03dac6" style="cursor:pointer;">
                    </div>
                </div>
                <div class="form-row" style="gap: 1rem; margin-bottom: 1rem;">
                    <div class="input-group">
                        <label>Start Date</label>
                        <input type="date" id="rlStart" style="background:var(--input-bg); color:#fff; color-scheme:dark;">
                    </div>
                    <div class="input-group">
                        <label>End Date</label>
                        <input type="date" id="rlEnd" style="background:var(--input-bg); color:#fff; color-scheme:dark;">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" style="color: var(--g-red); border-color:var(--g-red);" onclick="RoleManager.deleteRole()" id="btnDelRole">Delete</button>
                <button class="btn btn-primary" onclick="RoleManager.submitRole()">Save Role</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="eventModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="eventModalTitle">Add Event</h3>
                <button class="btn" onclick="ModalManager.closeModal('eventModal')">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="editEventIndex" value="-1">
                <div class="input-group">
                    <label>Event Name</label>
                    <input type="text" id="evName" placeholder="e.g. Q4 Audit">
                </div>
                <div class="input-group">
                    <label>Description</label>
                    <textarea id="evDesc" style="height: 60px; font-size: 0.85rem;" placeholder="Brief description..."></textarea>
                </div>
                <div class="form-row" style="gap: 1rem; margin-bottom: 1rem;">
                    <div class="input-group">
                        <label>Priority</label>
                        <div style="display: flex; gap: 10px; margin-top: 8px;">
                            <label style="font-size:0.85rem;"><input type="radio" name="evPriority" value="High"> High</label>
                            <label style="font-size:0.85rem;"><input type="radio" name="evPriority" value="Med" checked> Med</label>
                            <label style="font-size:0.85rem;"><input type="radio" name="evPriority" value="Low"> Low</label>
                        </div>
                    </div>
                    <div class="input-group">
                        <label>Colour tag</label>
                        <input type="text" readonly class="color-input" id="evColor" value="#bb86fc" style="cursor:pointer;">
                    </div>
                </div>
                <div class="form-row" style="gap: 1rem; margin-bottom: 1rem;">
                    <div class="input-group">
                        <label>Start Date</label>
                        <input type="date" id="evStart" style="background:var(--input-bg); color:#fff; color-scheme:dark;">
                    </div>
                    <div class="input-group">
                        <label>End Date</label>
                        <input type="date" id="evEnd" style="background:var(--input-bg); color:#fff; color-scheme:dark;">
                    </div>
                </div>
                
                <div class="input-group" style="margin-top: 1rem; border-top: 1px solid var(--border); padding-top: 1rem;">
                    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;">
                        <label style="margin:0;">Import CSV</label>
                        <span style="font-size:0.7rem; color:var(--text-muted);">Name, Desc, Start, End, [Priority], [Colour]</span>
                    </div>
                    <textarea id="evCsvInput" style="height: 60px; font-family: monospace; font-size: 0.8rem;" placeholder="Q1 Review, Reviewing Q1 perf, 2026-04-01, 2026-04-05"></textarea>
                    <button class="btn btn-sm" style="margin-top: 5px;" onclick="EventManager.parseCSV()">Import Events</button>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" style="margin-right:auto;" onclick="EventManager.duplicateEvent()" id="btnDuplicateEvent">Duplicate</button>
                <button class="btn" style="color: var(--g-red); border-color:var(--g-red);" onclick="EventManager.deleteEvent()" id="btnDelEvent">Delete</button>
                <button class="btn btn-primary" onclick="EventManager.submitEvent()">Save Event</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="taskModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="taskModalTitle">Add Task</h3>
                <button class="btn" onclick="ModalManager.closeModal('taskModal')">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="editTaskIndex" value="-1">
                <div class="input-group">
                    <label>Task Name</label>
                    <input type="text" id="tskName" placeholder="e.g. Update Documentation">
                </div>
                <div class="input-group">
                    <label>Assigned Roles</label>
                    <div id="tskRolesContainer" style="max-height: 120px; overflow-y: auto; border: 1px solid var(--border); padding: 10px; border-radius: 4px; background: rgba(0,0,0,0.1); display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 5px;">
                        <!-- Role checkboxes injected by JS -->
                    </div>
                </div>
                <div class="input-group">
                    <label>Description</label>
                    <textarea id="tskDesc" style="height: 60px; font-size: 0.85rem;" placeholder="Brief description..."></textarea>
                </div>
                <div class="form-row" style="gap: 1rem; margin-bottom: 1rem;">
                    <div class="input-group">
                        <label>Priority</label>
                        <div style="display: flex; gap: 10px; margin-top: 8px;">
                            <label style="font-size:0.85rem;"><input type="radio" name="tskPriority" value="High"> High</label>
                            <label style="font-size:0.85rem;"><input type="radio" name="tskPriority" value="Med" checked> Med</label>
                            <label style="font-size:0.85rem;"><input type="radio" name="tskPriority" value="Low"> Low</label>
                        </div>
                        <div style="margin-top: 10px;">
                            <label style="display:inline-flex; align-items:center; gap:5px; font-size:0.85rem; cursor:pointer; white-space:nowrap;">
                                <input type="checkbox" id="tskOnCall" style="accent-color:var(--accent);"> Out of Hours
                            </label>
                        </div>
                    </div>
                    <div class="input-group">
                        <label>Colour tag</label>
                        <input type="text" readonly class="color-input" id="tskColor" value="#00e676" style="cursor:pointer;">
                    </div>
                </div>

                <div class="input-group">
                    <label>Date Entry Mode</label>
                    <div style="display: flex; gap: 15px; margin-top: 5px; margin-bottom: 10px;">
                        <label style="font-size:0.85rem;"><input type="radio" name="tskDateMode" value="date" checked onchange="TaskManager.toggleDateMode()"> Actual Dates</label>
                        <label style="font-size:0.85rem;"><input type="radio" name="tskDateMode" value="period" onchange="TaskManager.toggleDateMode()"> Business Period</label>
                    </div>
                </div>

                <div id="tskDateRow" class="form-row" style="gap: 1rem; margin-bottom: 1rem;">
                    <div class="input-group">
                        <label>Start Date</label>
                        <input type="date" id="tskStart" style="background:var(--input-bg); color:#fff; color-scheme:dark;">
                    </div>
                    <div class="input-group">
                        <label>End Date</label>
                        <input type="date" id="tskEnd" style="background:var(--input-bg); color:#fff; color-scheme:dark;">
                    </div>
                </div>

                <div id="tskPeriodRow" class="form-row" style="gap: 1rem; margin-bottom: 1rem; display:none;">
                    <div class="input-group">
                        <label>Start Period</label>
                        <div style="display:flex; gap:5px;">
                            <select id="tskStartYear" style="padding:8px; background:var(--input-bg); color:#fff; border:1px solid var(--border); width:80px;"></select>
                            <select id="tskStartPeriod" style="padding:8px; background:var(--input-bg); color:#fff; border:1px solid var(--border); flex:1;"></select>
                        </div>
                    </div>
                    <div class="input-group">
                        <label>End Period</label>
                        <div style="display:flex; gap:5px;">
                            <select id="tskEndYear" style="padding:8px; background:var(--input-bg); color:#fff; border:1px solid var(--border); width:80px;"></select>
                            <select id="tskEndPeriod" style="padding:8px; background:var(--input-bg); color:#fff; border:1px solid var(--border); flex:1;"></select>
                        </div>
                    </div>
                </div>
                <button class="btn btn-sm" style="margin-bottom: 1rem; width: 100%;" onclick="TaskManager.clearDates()">Clear Dates (Set to Ongoing)</button>
            </div>
            <div class="modal-footer">
                <button class="btn" style="margin-right:auto;" onclick="TaskManager.duplicateTask()" id="btnDuplicateTask">Duplicate</button>
                <button class="btn" style="color: var(--g-red); border-color:var(--g-red);" onclick="TaskManager.deleteTask()" id="btnDelTask">Delete</button>
                <button class="btn btn-primary" onclick="TaskManager.submitTask()">Save Task</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="skillModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="skillModalTitle">Add Skill</h3>
                <button class="btn" onclick="ModalManager.closeModal('skillModal')">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="editSkillIndex" value="-1">
                <div class="input-group">
                    <label>Skill Name</label>
                    <input type="text" id="skName" placeholder="e.g. JavaScript">
                </div>
                <div class="input-group">
                    <label>Description</label>
                    <textarea id="skDesc" style="height: 60px; font-size: 0.85rem;" placeholder="Brief description..."></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn" style="color: var(--g-red); border-color:var(--g-red);" onclick="SkillManager.deleteSkill()" id="btnDelSkill">Delete</button>
                <button class="btn btn-primary" onclick="SkillManager.submitSkill()">Save Skill</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="assignUserModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Assign User to Role</h3>
                <button class="btn" onclick="ModalManager.closeModal('assignUserModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="input-group">
                    <label>User</label>
                    <select id="auUser" style="width:100%; padding:8px; background:var(--input-bg); color:#fff; border:1px solid var(--border);"></select>
                </div>
                <div class="input-group" style="margin-top:1rem;">
                    <label>Role / Task</label>
                    <select id="auRole" style="width:100%; padding:8px; background:var(--input-bg); color:#fff; border:1px solid var(--border);"></select>
                </div>
                <div class="form-row" style="margin-top:1rem; gap:1rem;">
                    <div class="input-group">
                        <label>Start Period</label>
                        <div style="display:flex; gap:5px;">
                            <select id="auStartYear" style="padding:8px; background:var(--input-bg); color:#fff; border:1px solid var(--border); width:80px;"></select>
                            <select id="auStartPeriod" style="padding:8px; background:var(--input-bg); color:#fff; border:1px solid var(--border); flex:1;"></select>
                        </div>
                    </div>
                    <div class="input-group">
                        <label>End Period</label>
                        <div style="display:flex; gap:5px;">
                            <select id="auEndYear" style="padding:8px; background:var(--input-bg); color:#fff; border:1px solid var(--border); width:80px;"></select>
                            <select id="auEndPeriod" style="padding:8px; background:var(--input-bg); color:#fff; border:1px solid var(--border); flex:1;"></select>
                        </div>
                    </div>
                </div>
                <div class="input-group" style="margin-top:1rem;">
                    <label>Allocation (%)</label>
                    <input type="number" id="auLoad" value="100" min="0" max="100">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="AssignmentManager.submitUserAssignment()">Assign</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="importTeamDataModal">
        <div class="modal-content modal-mini">
            <div class="modal-header">
                <h3>Import User Data</h3>
                <button class="btn" onclick="ModalManager.closeModal('importTeamDataModal')">&times;</button>
            </div>
            <div class="modal-body">
                <input type="file" id="teamDataFileInput" accept=".json" style="width:100%;">
                <p style="font-size:0.8rem; color:var(--text-muted); margin-top:10px;">Select a JSON file with roles, skills, users, and teams.</p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-primary" onclick="TeamDataManager.importJSON()">Import</button>
            </div>
        </div>
    </div>

    <!-- LOAD SCRIPT LAST to ensure it's available -->
    <!-- Changed to type="module" and added an export to window -->
    <script type="module">
        import * as AppModule from './app.js';
        
        // When module loads, expose it to window so HTML onclick works
        window.App = AppModule.App;
        window.UserManager = AppModule.UserManager;
        window.AssignmentManager = AppModule.AssignmentManager;
        window.RoleManager = AppModule.RoleManager;
        window.EventManager = AppModule.EventManager;
        window.TaskManager = AppModule.TaskManager;
        window.PlannerManager = AppModule.PlannerManager;
        window.TrackerManager = AppModule.TrackerManager;
        window.OverviewManager = AppModule.OverviewManager;
        window.ModalManager = AppModule.ModalManager;
        window.DataSaver = AppModule.DataSaver;
        window.DataLoader = AppModule.DataLoader;
        window.DataExporter = AppModule.DataExporter;
        window.SettingsManager = AppModule.SettingsManager;
        window.SkillManager = AppModule.SkillManager;
        window.TeamDataManager = AppModule.TeamDataManager;
        window.Visuals = AppModule.Visuals;

        // When ready, remove loading overlay
        window.addEventListener('DOMContentLoaded', () => {
            window.App.init();
            const overlay = document.getElementById('loadingOverlay');
            if (overlay) {
                overlay.style.opacity = '0';
                setTimeout(() => overlay.style.display = 'none', 100);
            }
        });
    </script>
</body>
</html>